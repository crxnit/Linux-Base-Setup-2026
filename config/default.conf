#!/bin/bash
# ============================================================================
# Linux Base Setup - Default Configuration
# ============================================================================
# This file contains all configurable parameters for the hardening script.
# Copy this to custom.conf and modify as needed.
# Values in custom.conf will override these defaults.
# ============================================================================

# --- General Settings ---
DRY_RUN=false                    # Set to true to preview changes without applying
INTERACTIVE=true                 # Set to false for unattended installations
BACKUP_DIR="/var/backups/hardening-$(date +%Y%m%d_%H%M%S)"
LOG_DIR="/var/log/hardening"

# --- User Configuration ---
CREATE_ADMIN_USER=true
ADMIN_USERNAME=""                # Will prompt if empty and INTERACTIVE=true
ADMIN_USER_SHELL="/bin/bash"
ADMIN_USER_GROUPS="sudo,adm"     # Comma-separated list

# --- SSH Configuration ---
CONFIGURE_SSH=true
SSH_PORT=2222
SSH_PERMIT_ROOT_LOGIN="no"
SSH_PASSWORD_AUTH="no"
SSH_PUBKEY_AUTH="yes"
SSH_MAX_AUTH_TRIES=3
SSH_LOGIN_GRACE_TIME=30
SSH_CLIENT_ALIVE_INTERVAL=300
SSH_CLIENT_ALIVE_COUNT_MAX=2
SSH_USE_PAM="yes"
SSH_X11_FORWARDING="no"
SSH_PRINT_LAST_LOG="yes"
SSH_PERMIT_EMPTY_PASSWORDS="no"
# Modern SSH hardening
SSH_KEY_EXCHANGE_ALGORITHMS="curve25519-sha256,curve25519-sha256@libssh.org,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,diffie-hellman-group-exchange-sha256"
SSH_CIPHERS="chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr"
SSH_MACS="hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512,hmac-sha2-256"
SSH_HOST_KEY_ALGORITHMS="ssh-ed25519,rsa-sha2-512,rsa-sha2-256"

# --- Hostname Configuration ---
CONFIGURE_HOSTNAME=true
HOSTNAME=""                      # Will auto-generate if empty
HOSTNAME_PREFIX="srv"            # Prefix for auto-generated hostnames

# --- Firewall Configuration ---
CONFIGURE_FIREWALL=true
FIREWALL_TYPE="ufw"              # Options: ufw, firewalld, none
UFW_DEFAULT_INCOMING="deny"
UFW_DEFAULT_OUTGOING="allow"
UFW_ALLOWED_PORTS="22/tcp,80/tcp,443/tcp"  # Comma-separated

# --- System Updates ---
PERFORM_UPDATES=true
PERFORM_DIST_UPGRADE=false          # Set to true to perform dist-upgrade (major version upgrades)
ENABLE_UNATTENDED_UPGRADES=true
UNATTENDED_UPGRADES_AUTO_REBOOT=false
UNATTENDED_UPGRADES_AUTO_REBOOT_TIME="03:00"

# --- Security Tools ---
INSTALL_FAIL2BAN=true
FAIL2BAN_MAX_RETRY=5
FAIL2BAN_BAN_TIME=3600
FAIL2BAN_FIND_TIME=600

INSTALL_AUDITD=true
CONFIGURE_AUDITD=true

INSTALL_RKHUNTER=true
INSTALL_LYNIS=false

# --- Kernel Hardening (sysctl) ---
CONFIGURE_SYSCTL=true
# Individual sysctl settings (true/false)
SYSCTL_IP_FORWARDING=false
SYSCTL_ACCEPT_SOURCE_ROUTE=false
SYSCTL_ACCEPT_REDIRECTS=false
SYSCTL_SEND_REDIRECTS=false
SYSCTL_RP_FILTER=true
SYSCTL_LOG_MARTIANS=true
SYSCTL_TCP_SYNCOOKIES=true
SYSCTL_ICMP_ECHO_IGNORE_BROADCASTS=true
SYSCTL_ICMP_IGNORE_BOGUS_ERROR_RESPONSES=true
SYSCTL_KERNEL_DMESG_RESTRICT=true
SYSCTL_KERNEL_KPTR_RESTRICT=true
SYSCTL_RANDOMIZE_VA_SPACE=true

# --- Time Synchronization ---
CONFIGURE_NTP=true
NTP_SERVICE="chrony"             # Options: chrony, systemd-timesyncd
TIMEZONE=""                      # Will prompt if empty, e.g., "America/New_York"

# --- Additional Security ---
CONFIGURE_APPARMOR=false
DISABLE_USB_STORAGE=false
DISABLE_UNCOMMON_PROTOCOLS=true  # Disable dccp, sctp, rds, tipc
CONFIGURE_UMASK=true
DEFAULT_UMASK="027"

# --- Password Policies ---
CONFIGURE_PASSWORD_POLICY=true
PASSWORD_MIN_LENGTH=12
PASSWORD_MIN_COMPLEXITY=3        # Requires mix of upper, lower, digits, special
PASSWORD_MAX_DAYS=90
PASSWORD_MIN_DAYS=1
PASSWORD_WARN_DAYS=7

# --- Logging and Auditing ---
CONFIGURE_RSYSLOG=true
ENABLE_REMOTE_LOGGING=false
REMOTE_LOG_SERVER=""

# --- Optional Features ---
INSTALL_DOCKER=false
CONFIGURE_SWAP=false
SWAP_SIZE="2G"
